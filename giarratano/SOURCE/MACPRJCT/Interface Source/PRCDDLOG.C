   /*******************************************************/   /*      "C" Language Integrated Production System      */   /*                                                     */   /*             Macintosh Version 3.3  04/02/96         */   /*                                                     */   /*           DEFGENERIC DIALOG MANAGER MODULE          */   /*******************************************************//*************************************************************//* Purpose:                                                  *//*                                                           *//* Principal Programmer(s):                                  *//*      Gary D. Riley                                        *//*                                                           *//* Contributing Programmer(s):                               *//*                                                           *//* Revision History:                                         *//*                                                           *//*************************************************************/#define _PRCDDLOG_SOURCE_#include "setup.h"#include <string.h>#include <stdlib.h>#include <Dialogs.h>#if MAC_MPW || MAC_MCW#include <strings.h>#else#include <pascal.h>#endif#if MAC_SC7 || MAC_MCW || MAC_SC8#define ClickPtr ListClickLoopUPP#else#define ClickPtr ProcPtr#endif#if MAC_MCW || MAC_SC8#define ModalPtr ModalFilterUPP#else#define ModalPtr ModalFilterProcPtr#endif#include "router.h"#include "commline.h"#include "dffnxfun.h"#include "globldef.h"#include "globlbsc.h"#include "dlogmngr.h"#include "window.h"#include "stnrdmac.h" #include "prcddlog.h"/***************************************//* LOCAL INTERNAL FUNCTION DEFINITIONS *//***************************************/   static void                   UpdateDeffunctionButtons(DialogPtr,int);   static void                   UpdateDefglobalButtons(DialogPtr,int);#if DEFFUNCTION_CONSTRUCT/****************************************************************//* DoDeffunctionManager: Handle Deffunction Manager... command. *//****************************************************************/void DoDeffunctionManager()  {   short int itemNumber = 0;   int selection;   int numberOfDeffunctions;   void *dptr;      CreateDialogManager(DEFFUNCTION_DIALOG_RESOURCE_NUMBER,TRUE);   numberOfDeffunctions = PrepManager(DEFFUNCTION_DIALOG_SELECT,                                      GetNextDeffunction,                                      (char *(*)(VOID *)) GetConstructNameString,TRUE,false,(StringPtr) "\p");   /*============================================================*/   /* Define a ClikLoop function to be called repeatedly as long */   /* as the mouse button is held down inside the deffunction    */   /* list. This loop will update the remove... button for the   */   /* currently selected deffunction.                            */   /*============================================================*/   UpdateConstructManagerButtonsFunction = UpdateDeffunctionButtons;   (*Choices)->lClickLoop = (ClickPtr) DefaultConstructManagerClikloopRef;   /*===========================================================*/   /* Set a global variable indicating which item in the dialog */   /* box is the list. This global value will be used by the    */   /* filter function for the dialog box.                       */   /*===========================================================*/   SelectItem = DEFFUNCTION_DIALOG_SELECT;   /*====================================================*/   /* Initialize the last dialog item selected variable. */   /*====================================================*/   itemNumber = DEFFUNCTION_DIALOG_SELECT;   selection = PutSelectionNameInBuffer();   dptr = FindDeffunction(DialogBuffer);   /*====================================================================*/   /* Outline the Done button to indicate that it is the default button. */   /*====================================================================*/   OutlineButton(ManagerDialog,DEFFUNCTION_DIALOG_DONE,TRUE);   /*========================================================*/   /* Update the method... button for the current selection. */   /*========================================================*/   UpdateDeffunctionButtons(ManagerDialog,selection);   /*==================================================================*/   /* Remain in this loop until the user has selected the done button. */   /* The function SingleSelectFilter that is passed as an argument to */   /* ModalDialog is used to handle mouse-clicks in the list.          */   /*==================================================================*/   while (itemNumber != DEFFUNCTION_DIALOG_DONE)     {      ModalDialog((ModalPtr) SingleSelectFilterRef,&itemNumber);      switch(itemNumber)        {         case DEFFUNCTION_DIALOG_SELECT:           selection = PutSelectionNameInBuffer();           dptr = FindDeffunction(DialogBuffer);           break;         case DEFFUNCTION_DIALOG_PRINT:           GenericPrintButton(FindDeffunction,(char *(*)(VOID *)) GetConstructPPForm,"(ppdeffunction ",NULL);           break;         case DEFFUNCTION_DIALOG_REMOVE:           GenericDeleteButton1(FindDeffunction,Undeffunction,&selection,                                &numberOfDeffunctions,(StringPtr) "\p");           break;                    case DEFFUNCTION_DIALOG_WATCH:#if DEBUGGING_FUNCTIONS           SetDeffunctionWatch(GetDeffunctionWatch(dptr) ? OFF : ON,dptr);#endif           break;        }      UpdateDeffunctionButtons(ManagerDialog,selection);     }   CleanUpAfterManagerDialog(TRUE);  }/************************************************//* UpdateDeffunctionButtons: Updates the buttons *//* in the Deffunction Manager dialog box.        *//************************************************/static void UpdateDeffunctionButtons(dptr,selection)  DialogPtr dptr;  int selection;  {#if MAC_MPW || MAC_MCW#pragma unused(selection)#endif   Handle itemHandle;   Rect dispRect;   short int itemType;   void *theDeffunction;   PutSelectionNameInBuffer();   theDeffunction = FindDeffunction(DialogBuffer);   /*=========================================================*/   /* Get information about the remove... button dialog item. */   /*=========================================================*/   GetDItem(dptr,DEFFUNCTION_DIALOG_REMOVE,&itemType,&itemHandle,&dispRect);   if ((theDeffunction == NULL) ? false : IsDeffunctionDeletable(theDeffunction))     { HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE); }   else     { HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE); }   /*===========================================================*/   /* Get information about the trace... checkbox dialog item.  */   /*===========================================================*/      GetDItem(dptr,DEFFUNCTION_DIALOG_WATCH,&itemType,&itemHandle,&dispRect);#if DEBUGGING_FUNCTIONS   if (theDeffunction != NULL)     {      SetCheckBox(dptr,DEFFUNCTION_DIALOG_WATCH,GetDeffunctionWatch(theDeffunction));      HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE);     }   else#endif     {      SetCheckBox(dptr,DEFFUNCTION_DIALOG_WATCH,0);      HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE);     }   /*=========================================================*/   /* Get information about the print... button dialog item. */   /*=========================================================*/   GetDItem(dptr,DEFFUNCTION_DIALOG_PRINT,&itemType,&itemHandle,&dispRect);   if ((theDeffunction == NULL) ? false : (GetDeffunctionPPForm(theDeffunction) != NULL))     { HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE); }   else     { HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE); }   }#endif#if DEFGLOBAL_CONSTRUCT/**********************************************************//* DoDefglobalManager: Handle Defglobal Manager... command. *//**********************************************************/void DoDefglobalManager()  {   short int itemNumber = 0;   int selection;   int numberOfDefglobals;   void *dptr;   CreateDialogManager(DEFGLOBAL_DIALOG_RESOURCE_NUMBER,TRUE);   numberOfDefglobals = PrepManager(DEFGLOBAL_DIALOG_SELECT,                                  GetNextDefglobal,                                  (char *(*)(VOID *)) GetConstructNameString,                                  TRUE,false,(StringPtr) "\p");   /*===============================================================*/   /* Define a ClikLoop function to be called repeatedly as long as */   /* the mouse button is held down inside the list of items. This  */   /* loop will update buttons applicable to the currently selected */   /* item.                                                         */   /*===============================================================*/   UpdateConstructManagerButtonsFunction = UpdateDefglobalButtons;   (*Choices)->lClickLoop = (ClickPtr) DefaultConstructManagerClikloopRef;   /*===========================================================*/   /* Set a global variable indicating which item in the dialog */   /* box is the list. This global value will be used by the    */   /* filter function for the dialog box.                       */   /*===========================================================*/   SelectItem = DEFGLOBAL_DIALOG_SELECT;   /*====================================================*/   /* Initialize the last dialog item selected variable. */   /*====================================================*/   itemNumber = DEFGLOBAL_DIALOG_SELECT;   selection = PutSelectionNameInBuffer();   dptr = FindDefglobal(DialogBuffer);   /*====================================================================*/   /* Outline the Done button to indicate that it is the default button. */   /*====================================================================*/   OutlineButton(ManagerDialog,DEFGLOBAL_DIALOG_DONE,TRUE);   /*===============================================*/   /* Update the buttons for the current selection. */   /*===============================================*/   UpdateDefglobalButtons(ManagerDialog,selection);   /*==================================================================*/   /* Remain in this loop until the user has selected the done button. */   /* The function SingleSelectFilter that is passed as an argument to */   /* ModalDialog is used to handle mouse-clicks in the list.          */   /*==================================================================*/   while (itemNumber != DEFGLOBAL_DIALOG_DONE)     {      ModalDialog((ModalPtr) SingleSelectFilterRef,&itemNumber);      switch(itemNumber)        {         case DEFGLOBAL_DIALOG_SELECT:           selection = PutSelectionNameInBuffer();           dptr = FindDefglobal(DialogBuffer);           break;         case DEFGLOBAL_DIALOG_PRINT:           GenericPrintButton(FindDefglobal,(char *(*)(VOID *)) GetConstructPPForm,"(ppdefglobal ",NULL);           break;         case DEFGLOBAL_DIALOG_REMOVE:           GenericDeleteButton1(FindDefglobal,Undefglobal,&selection,&numberOfDefglobals,(StringPtr) "\p");           break;                    case DEFGLOBAL_DIALOG_WATCH:#if DEBUGGING_FUNCTIONS           SetDefglobalWatch(GetDefglobalWatch(dptr) ? OFF : ON,dptr);#endif           break;         default:           break;        }      UpdateDefglobalButtons(ManagerDialog,selection);     }   CleanUpAfterManagerDialog(TRUE);  }/**********************************************//* UpdateDefglobalButtons: Updates the buttons *//* in the Defglobal Manager dialog box.        *//**********************************************/static void UpdateDefglobalButtons(dptr,selection)  DialogPtr dptr;  int selection;  {#if MAC_MPW || MAC_MCW#pragma unused(selection)#endif   Handle itemHandle;   Rect dispRect;   short int itemType;   void *theDefglobal;   PutSelectionNameInBuffer();   theDefglobal = FindDefglobal(DialogBuffer);   /*=========================================================*/   /* Get information about the remove... button dialog item. */   /*=========================================================*/   GetDItem(dptr,DEFGLOBAL_DIALOG_REMOVE,&itemType,&itemHandle,&dispRect);   if ((theDefglobal == NULL) ? false : IsDefglobalDeletable(theDefglobal))     { HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE); }   else     { HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE); }     /*===========================================================*/   /* Get information about the trace... checkbox dialog item.  */   /*===========================================================*/      GetDItem(dptr,DEFGLOBAL_DIALOG_WATCH,&itemType,&itemHandle,&dispRect);#if DEBUGGING_FUNCTIONS   if (theDefglobal != NULL)     {      SetCheckBox(dptr,DEFGLOBAL_DIALOG_WATCH,GetDefglobalWatch(theDefglobal));      HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE);     }   else#endif     {      SetCheckBox(dptr,DEFGLOBAL_DIALOG_WATCH,0);      HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE);     }   /*=========================================================*/   /* Get information about the print... button dialog item. */   /*=========================================================*/   GetDItem(dptr,DEFGLOBAL_DIALOG_PRINT,&itemType,&itemHandle,&dispRect);   if ((theDefglobal == NULL) ? false : (GetDefglobalPPForm(theDefglobal) != NULL))     { HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE); }   else     { HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE); }  }#endif