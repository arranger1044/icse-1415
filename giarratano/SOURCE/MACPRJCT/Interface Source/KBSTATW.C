   /*******************************************************/   /*      "C" Language Integrated Production System      */   /*                                                     */   /*            Macintosh Version 3.2  05/12/93          */   /*                                                     */   /*         KNOWLEDGE BASE STATUS WINDOWS MODULE        */   /*******************************************************//*************************************************************//* Purpose:                                                  *//*                                                           *//* Principal Programmer(s):                                  *//*      Gary D. Riley                                        *//*                                                           *//* Contributing Programmer(s):                               *//*                                                           *//* Revision History:                                         *//*                                                           *//*************************************************************/#define _KBSTATW_SOURCE_#include "setup.h"#include <string.h>#include <Memory.h>#include <Windows.h>#include <Controls.h>#include <Events.h>#include <TextEdit.h>#if THINK_C /* Defined by the Think C Environment */#include <pascal.h>#else#include <strings.h>#endif#if MAC_SC7#define CTOPSTR C2PStr#else#define CTOPSTR c2pstr#endif#include "factmngr.h"#include "engine.h"#include "inscom.h"#include "globldef.h"#include "commline.h"#include "filecom.h"#include "agenda.h"#include "apprsrcs.h"#include "editdlog.h"#include "editw.h"#include "interface.h"#include "menuhndl.h"#include "prefernc.h"#include "search.h"#include "statusw.h"#include "undo.h"#include "window.h"#include "kbstatw.h"/***************************************//* LOCAL INTERNAL FUNCTION DEFINITIONS *//***************************************/#if ANSI_COMPILER   static VOID                    GetFocusPPForm(char *,int,VOID *);#else   static VOID                    GetFocusPPForm();#endif/****************************************//* GLOBAL INTERNAL VARIABLE DEFINITIONS *//****************************************/   WindowPtr               AgendaWindow;   WindowPtr               FactsWindow;   WindowPtr               InstancesWindow;   WindowPtr               GlobalsWindow;   WindowPtr               FocusWindow;/********************************************************//* InitializeFactsWindow: Initializes the facts window. *//********************************************************/void InitializeFactsWindow()  {   short hsize, vsize, wleft, wtop;#if DEFTEMPLATE_CONSTRUCT   if ((HonorEnvironmentWindowState == FALSE) ||       (RecallPositionPreferences(factsPositionResID,&wtop,&wleft,                                  &vsize,&hsize) == FALSE))     {      hsize = 0.40 * (GetWorkingScreenWidth() - (6 + 6 + 6));      vsize = (1.0 / 3.0) * (GetWorkingScreenHeight() - (46 + 26 + 26 + 6));      wtop = 46;      wleft = 6 + (0.60 * (GetWorkingScreenWidth() - (6 + 6 + 6))) + 6;     }   FactsWindow = CreateStatusWindow(wtop,wleft,hsize,vsize,(StringPtr) "\pFacts",                                    GetNextFactInScope,GetFactPPForm,&FactsWindow,                                    false,factsPositionResID);   UpdateStatusWindowTitle(FactsWindow,"Facts");   ShowWindow(FactsWindow);#endif  }/***********************************************************//* InitializeAgendaWindow:  Initializes the agenda window. *//***********************************************************/void InitializeAgendaWindow()  {   short hsize, vsize, wleft, wtop;#if DEFRULE_CONSTRUCT   if ((HonorEnvironmentWindowState == FALSE) ||       (RecallPositionPreferences(agendaPositionResID,&wtop,&wleft,                                  &vsize,&hsize) == FALSE))     {      hsize = 0.40 * (GetWorkingScreenWidth() - (6 + 6 + 6 + 6));      vsize = (1.0 / 3.0) * (GetWorkingScreenHeight() - (46 + 26 + 26 + 6));      wtop = 46 + 26 + 26 + vsize + vsize;      wleft = 6;     }   AgendaWindow = CreateStatusWindow(wtop,wleft,hsize,vsize,(StringPtr) "\pAgenda",                                     GetNextActivation,GetActivationPPForm,&AgendaWindow,                                     false,agendaPositionResID);   UpdateStatusWindowTitle(AgendaWindow,"Agenda");   ShowWindow(AgendaWindow);#endif  }/****************************************************************//* InitializeInstancesWindow: Initializes the instances window. *//****************************************************************/void InitializeInstancesWindow()  {   short hsize, vsize, wleft, wtop;   /*============================================================*/   /* Size and Place the window on the right edge of the screen. */   /*============================================================*/#if OBJECT_SYSTEM   if ((HonorEnvironmentWindowState == FALSE) ||       (RecallPositionPreferences(instancesPositionResID,&wtop,&wleft,                                  &vsize,&hsize) == FALSE))     {      hsize = 0.40 * (GetWorkingScreenWidth() - (6 + 6 + 6));      vsize = (1.0 / 3.0) * (GetWorkingScreenHeight() - (46 + 26 + 26 + 6));      wtop = 46 + 26 + vsize;      wleft = 6 + (0.60 * (GetWorkingScreenWidth() - (6 + 6 + 6))) + 6;     }   InstancesWindow = CreateStatusWindow(wtop,wleft,hsize,vsize,(StringPtr) "\pInstances",                                        GetNextInstanceInScope,GetInstancePPForm,                                        &InstancesWindow,false,instancesPositionResID);   UpdateStatusWindowTitle(InstancesWindow,"Instances");   ShowWindow(InstancesWindow);#endif  }/************************************************************//* InitializeGlobalsWindow: Initializes the globals window. *//************************************************************/void InitializeGlobalsWindow()  {   short hsize, vsize, wleft, wtop;   /*============================================================*/   /* Size and Place the window on the right edge of the screen. */   /*============================================================*/   #if DEFGLOBAL_CONSTRUCT   if ((HonorEnvironmentWindowState == FALSE) ||       (RecallPositionPreferences(globalsPositionResID,&wtop,&wleft,                                  &vsize,&hsize) == FALSE))     {      hsize = 0.40 * (GetWorkingScreenWidth() - (6 + 6 + 6));      vsize = (1.0 / 3.0) * (GetWorkingScreenHeight() - (46 + 26 + 26 + 6));      wtop = 46 + 26 + 26 + vsize + vsize;      wleft = 6 + (0.60 * (GetWorkingScreenWidth() - (6 + 6 + 6))) + 6;     }   GlobalsWindow = CreateStatusWindow(wtop,wleft,hsize,vsize,(StringPtr) "\pGlobals",                                      GetNextDefglobalInScope,GetDefglobalValueForm,                                      &GlobalsWindow,false,globalsPositionResID);   UpdateStatusWindowTitle(GlobalsWindow,"Globals");   ShowWindow(GlobalsWindow);#endif  }/*********************************************************//* InitializeFocusWindow:  Initializes the focus window. *//*********************************************************/void InitializeFocusWindow()  {   short hsize, vsize, wleft, wtop;#if DEFRULE_CONSTRUCT   if ((HonorEnvironmentWindowState == FALSE) ||       (RecallPositionPreferences(focusPositionResID,&wtop,&wleft,                                  &vsize,&hsize) == FALSE))     {      hsize = 0.20 * (GetWorkingScreenWidth() - (6 + 6 + 6 + 6));      vsize = (1.0 / 3.0) * (GetWorkingScreenHeight() - (46 + 26 + 26 + 6));      wtop = 46 + 26 + 26 + vsize + vsize;      wleft = 6 + (0.40 * (GetWorkingScreenWidth() - (6 + 6 + 6 + 6))) + 6;     }   FocusWindow = CreateStatusWindow(wtop,wleft,hsize,vsize,(StringPtr) "\pFocus",                                     GetNextFocus,GetFocusPPForm,&FocusWindow,                                     TRUE,focusPositionResID);   ShowWindow(FocusWindow);#endif  }  /********************************************************************//* SelectFactsWindow: Makes the facts window the front-most window. *//********************************************************************/void SelectFactsWindow()  {#if DEFTEMPLATE_CONSTRUCT   if (FactsWindow == NULL) InitializeFactsWindow();   SelectWindow(FactsWindow);#endif  }/**********************************************************************//* SelectAgendaWindow: Makes the agenda window the front-most window. *//**********************************************************************/void SelectAgendaWindow()  {#if DEFRULE_CONSTRUCT   if (AgendaWindow == NULL) InitializeAgendaWindow();   SelectWindow(AgendaWindow);#endif  }/****************************************************************************//* SelectInstancesWindow: Makes the instances window the front-most window. *//****************************************************************************/void SelectInstancesWindow()  {#if OBJECT_SYSTEM   if (InstancesWindow == NULL) InitializeInstancesWindow();   SelectWindow(InstancesWindow);#endif  }/************************************************************************//* SelectGlobalsWindow: Makes the globals window the front-most window. *//************************************************************************/void SelectGlobalsWindow()  {#if DEFGLOBAL_CONSTRUCT   if (GlobalsWindow == NULL) InitializeGlobalsWindow();   SelectWindow(GlobalsWindow);#endif  }  /********************************************************************//* SelectFocusWindow: Makes the focus window the front-most window. *//********************************************************************/void SelectFocusWindow()  {#if DEFRULE_CONSTRUCT   if (FocusWindow == NULL) InitializeFocusWindow();   SelectWindow(FocusWindow);#endif  }  /*****************************************************************//* DisplayApplicationHook:                                  *//*****************************************************************/int DisplayApplicationHook(WindowPtr whichWindow,EventRecord *thisEvent,                                THPrint printRecord,char thisChar,int whichMessage)  {#if MAC_MPW || MAC_MCW#pragma unused(whichWindow,thisEvent,printRecord,thisChar)#endif   /*=====================*/   /* Handle the message. */   /*=====================*/   switch(whichMessage)     {      case KEYSTROKE_MESSAGE:        break;      case MENU_UPDATE_MESSAGE:        EnableItem(EditMenu,ClearWindowItem);#if ! RUN_TIME        if (EvaluatingTopLevelCommand || BatchActive())#else        if (BatchActive())#endif          {           DisableStandardMenuItem(STANDARD_MENU_ITEM_COPY);           DisableStandardMenuItem(STANDARD_MENU_ITEM_PASTE);          }        else          { EnableItem(EditMenu,CompleteItem); }        break;     }   return(1);  } /**************************************//* UpdateStatusWindowTitle:          *//**************************************/void UpdateStatusWindowTitle(theWindow,prefixTitle)  WindowPtr theWindow;  char *prefixTitle;  {   struct defmodule *theModule;   Str255 theTitle;   theModule = ((struct defmodule *) GetCurrentModule());         sprintf((char *) theTitle,"%s (%s)",prefixTitle,GetDefmoduleName(theModule));   CTOPSTR((char *) theTitle);   SetWTitle(theWindow,theTitle);  }  /***********************************************************************//* GetFocusPPForm: Returns the pretty print representation of a focus. *//***********************************************************************/static VOID GetFocusPPForm(buffer,bufferLength,vTheFocus)  char *buffer;  int bufferLength;  VOID *vTheFocus;  {   struct focus *theFocus = (struct focus *) vTheFocus;      strncpy(buffer,GetDefmoduleName(theFocus->theModule),bufferLength);  }