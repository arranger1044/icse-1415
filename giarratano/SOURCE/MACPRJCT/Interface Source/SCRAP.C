   /*******************************************************/   /*      "C" Language Integrated Production System      */   /*                                                     */   /*            Macintosh Version 3.2  05/12/93          */   /*                                                     */   /*                SCRAP MANAGER MODULE                 */   /*******************************************************//*************************************************************//* Purpose:                                                  *//*                                                           *//* Principal Programmer(s):                                  *//*      Gary D. Riley                                        *//*                                                           *//* Contributing Programmer(s):                               *//*                                                           *//* Revision History:                                         *//*                                                           *//*************************************************************/#define _SCRAP_SOURCE_#include <stddef.h>#include <TextEdit.h>#include <Scrap.h>#include <Menus.h>#include "clpscrap.h"/***************************************//* LOCAL INTERNAL VARIABLE DEFINITIONS *//***************************************/   static MenuHandle       ScrapEditMenu = NULL;   static int              ScrapPasteItem = -1;   static int              ScrapCompare;   static int              ScrapDirty;/******************************************************//* ReadDeskScrap: Read desk scrap into toolbox scrap. *//******************************************************/void ReadDeskScrap()  {   PScrapStuff scrap_ptr;   long int scrapLength = 0;   long int ignore;   OSErr result;   /*===========================================*/   /* If the scrap hasn't changed, then return. */   /*===========================================*/   scrap_ptr = InfoScrap();   if (ScrapCompare == scrap_ptr->scrapCount) return;   /*=======================================*/   /* Check the desk scrap for a text item. */   /*=======================================*/   scrapLength = GetScrap(NULL,'TEXT',&ignore);   /*=======================================================*/   /* If there is a text item, then transfer the desk scrap */   /* to the toolbox scrap. If no error occurs, then assign */   /* assign the correct scrap length.                      */   /*=======================================================*/   if (scrapLength >= 0)     {      result = TEFromScrap();      if (result != noErr)        { scrapLength = result; }     }   /*==================================================*/   /* If the scrap was nonempty, then enable the Paste */   /* command. Otherwise, mark the toolbox scrap as    */   /* empty and disable the Paste command.             */   /*==================================================*/   if (scrapLength > 0)     {     }   else     { TESetScrapLen(0); }   /*========================================*/   /* Save scrap count for later comparison. */   /*========================================*/   ScrapCompare = scrap_ptr->scrapCount;  }/******************************************************//* WriteDeskScrap: Write toolbox scrap to desk scrap. *//******************************************************/void WriteDeskScrap()  {   /*===================================*/   /* If the scrap hasn't changed since */   /* the last read, then return.       */   /*===================================*/   if (! ScrapDirty) return;   /*==========================================================*/   /* Change the scrap count and save it for later comparison. */   /*==========================================================*/   ScrapCompare = ZeroScrap();   /*===============================================*/   /* Transfer the toolbox scrap to the desk scrap. */   /*===============================================*/   TEToScrap();   /*====================================*/   /* Toolbox and desk scraps now agree. */   /*====================================*/   ScrapDirty = false;  }/**********************************************************************//* InitializeScrap: Initializes the scrap for use by the application. *//**********************************************************************/void InitializeScrap(theEditMenu,thePasteItem)  MenuHandle theEditMenu;  int thePasteItem;  {   PScrapStuff scrap_ptr;   /*===========================================*/   /* Remember the Paste Item in the Edit menu. */   /*===========================================*/   ScrapEditMenu = theEditMenu;   ScrapPasteItem = thePasteItem;   /*==========================================*/   /* Toolbox and desk scraps initially agree. */   /*==========================================*/   ScrapDirty = false;   /*=======================*/   /* Force scrap transfer. */   /*=======================*/   scrap_ptr = InfoScrap();   ScrapCompare = scrap_ptr->scrapCount + 1;   /*=====================================*/   /* Read desk scrap into toolbox scrap. */   /*=====================================*/   ReadDeskScrap();  }/**********************************************************************//* SetScrapDirtyStatus: *//**********************************************************************/void SetScrapDirtyStatus(value)  int value;  {   ScrapDirty = value;  }/**********************************************************************//* GetScrapDirtyStatus: *//**********************************************************************/int GetScrapDirtyStatus()  {   return(ScrapDirty);  }