   /*******************************************************/   /*      "C" Language Integrated Production System      */   /*                                                     */   /*             Macintosh Version 3.3  04/02/96         */   /*                                                     */   /*         EXECUTION MENU DIALOG MANAGER MODULE        */   /*******************************************************//*************************************************************//* Purpose:                                                  *//*                                                           *//* Principal Programmer(s):                                  *//*      Gary D. Riley                                        *//*                                                           *//* Contributing Programmer(s):                               *//*                                                           *//* Revision History:                                         *//*                                                           *//*************************************************************/#define _EXECDLOG_SOURCE_#include "setup.h"#include <ctype.h>#include <Dialogs.h>#include <TextUtils.h>#if MAC_SC7 || MAC_MPW || MAC_MCW || MAC_SC8#define GRAY (&qd.gray)#define BLACK (&qd.black)#else#define GRAY (qd.gray)#define BLACK (qd.black)#endif#if MAC_MCW || MAC_SC8#define ModalPtr ModalFilterUPP#else#define ModalPtr ModalFilterProcPtr#endif#include "watch.h"#include "ruledef.h"#include "crstrtgy.h"#include "globlcom.h"#include "facthsh.h"#include "incrrset.h"#include "bmathfun.h"#include "exprnpsr.h"#include "apprsrcs.h"#include "window.h"#include "interface.h"#include "stnrdmac.h"#include "menuhndl.h"#include "prefernc.h"#include "execdlog.h"/*******************************************//* DoWatchDialog: Handle Watch... command. *//*******************************************/void DoWatchDialog()  {   DialogPtr dptr;   short int itemNumber = 0;   short int itemType;   Handle itemHandle;   Rect dispRect;   GrafPtr savePort;   int count;   WatchRSRCHdl theResource;   /*=========================*/   /* Save the previous port. */   /*=========================*/   GetPort(&savePort);   /*==============================================*/   /* Get the dialog and make it the current port. */   /*==============================================*/   InitCursor();   dptr = GetNewDialog(WATCH_DIALOG_RESOURCE_NUMBER,NULL,(WindowPtr) -1L);   SetPort(dptr);   CenterWindow(dptr,0.5,0.33);   ShowWindow(dptr);   /*==================================================================*/   /* Outline the OK button to indicate that it is the default button. */   /*==================================================================*/   OutlineButton(dptr,WATCH_DIALOG_OK,TRUE);   /*=================================================================*/   /* Frame the two lines included in the dialog (for visual effect). */   /*=================================================================*/   PenPat(GRAY);   GetDItem(dptr,WATCH_DIALOG_TOP_LINE,&itemType,&itemHandle,&dispRect);   FrameRect(&dispRect);   GetDItem(dptr,WATCH_DIALOG_BOTTOM_LINE,&itemType,&itemHandle,&dispRect);   FrameRect(&dispRect);   PenPat(BLACK);   /*===============================================*/   /* The cursor for the dialog should be an arrow. */   /*===============================================*/   InitCursor();   /*====================================================*/   /* Set the watch check boxes to their current values. */   /*====================================================*/   count = 0;#if DEBUGGING_FUNCTIONS   count += SetCheckBox(dptr,WATCH_DIALOG_COMPILATIONS,GetWatchItem("compilations"));   count += SetCheckBox(dptr,WATCH_DIALOG_FACTS,GetWatchItem("facts"));   count += SetCheckBox(dptr,WATCH_DIALOG_INSTANCES,GetWatchItem("instances"));   count += SetCheckBox(dptr,WATCH_DIALOG_RULES,GetWatchItem("rules"));   count += SetCheckBox(dptr,WATCH_DIALOG_GENERIC_FUNCTIONS,GetWatchItem("generic-functions"));   count += SetCheckBox(dptr,WATCH_DIALOG_MESSAGE_HANDLERS,GetWatchItem("message-handlers"));   count += SetCheckBox(dptr,WATCH_DIALOG_DEFFUNCTIONS,GetWatchItem("deffunctions"));   count += SetCheckBox(dptr,WATCH_DIALOG_STATISTICS,GetWatchItem("statistics"));   count += SetCheckBox(dptr,WATCH_DIALOG_GLOBALS,GetWatchItem("globals"));   count += SetCheckBox(dptr,WATCH_DIALOG_SLOTS,GetWatchItem("slots"));   count += SetCheckBox(dptr,WATCH_DIALOG_ACTIVATIONS,GetWatchItem("activations"));   count += SetCheckBox(dptr,WATCH_DIALOG_METHODS,GetWatchItem("methods"));   count += SetCheckBox(dptr,WATCH_DIALOG_MESSAGES,GetWatchItem("messages"));   count += SetCheckBox(dptr,WATCH_DIALOG_FOCUS,GetWatchItem("focus"));#endif   if (count == 0)     {      GetDItem(dptr,WATCH_DIALOG_NONE,&itemType,&itemHandle,&dispRect);      HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE);     }   else if (count == NUMBER_OF_WATCH_ITEMS)     {      GetDItem(dptr,WATCH_DIALOG_ALL,&itemType,&itemHandle,&dispRect);      HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE);     }   else     {      GetDItem(dptr,WATCH_DIALOG_NONE,&itemType,&itemHandle,&dispRect);      HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE);      GetDItem(dptr,WATCH_DIALOG_ALL,&itemType,&itemHandle,&dispRect);      HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE);     }   /*=====================*/   /* Conduct the dialog. */   /*=====================*/   itemNumber = -1;   while ((itemNumber != WATCH_DIALOG_OK) && (itemNumber != WATCH_DIALOG_CANCEL))     {      ModalDialog((ModalPtr) DefaultDialogFilterRef,&itemNumber);      switch (itemNumber)        {         case WATCH_DIALOG_COMPILATIONS:         case WATCH_DIALOG_FACTS:         case WATCH_DIALOG_INSTANCES:         case WATCH_DIALOG_RULES:         case WATCH_DIALOG_GENERIC_FUNCTIONS:         case WATCH_DIALOG_MESSAGE_HANDLERS:         case WATCH_DIALOG_DEFFUNCTIONS:         case WATCH_DIALOG_STATISTICS:         case WATCH_DIALOG_GLOBALS:         case WATCH_DIALOG_SLOTS:         case WATCH_DIALOG_ACTIVATIONS:         case WATCH_DIALOG_METHODS:         case WATCH_DIALOG_MESSAGES:         case WATCH_DIALOG_FOCUS:           if (ToggleCheckBox(dptr,itemNumber)) count++;           else count--;           if (count == 0)             {              GetDItem(dptr,WATCH_DIALOG_NONE,&itemType,&itemHandle,&dispRect);              HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE);             }           else if (count == NUMBER_OF_WATCH_ITEMS)             {              GetDItem(dptr,WATCH_DIALOG_ALL,&itemType,&itemHandle,&dispRect);              HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE);             }           else             {              GetDItem(dptr,WATCH_DIALOG_NONE,&itemType,&itemHandle,&dispRect);              HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE);              GetDItem(dptr,WATCH_DIALOG_ALL,&itemType,&itemHandle,&dispRect);              HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE);             }           break;         case WATCH_DIALOG_ALL:           SetCheckBox(dptr,WATCH_DIALOG_COMPILATIONS,1);           SetCheckBox(dptr,WATCH_DIALOG_FACTS,1);           SetCheckBox(dptr,WATCH_DIALOG_INSTANCES,1);           SetCheckBox(dptr,WATCH_DIALOG_RULES,1);           SetCheckBox(dptr,WATCH_DIALOG_GENERIC_FUNCTIONS,1);           SetCheckBox(dptr,WATCH_DIALOG_MESSAGE_HANDLERS,1);           SetCheckBox(dptr,WATCH_DIALOG_DEFFUNCTIONS,1);           SetCheckBox(dptr,WATCH_DIALOG_STATISTICS,1);           SetCheckBox(dptr,WATCH_DIALOG_GLOBALS,1);           SetCheckBox(dptr,WATCH_DIALOG_SLOTS,1);           SetCheckBox(dptr,WATCH_DIALOG_ACTIVATIONS,1);           SetCheckBox(dptr,WATCH_DIALOG_METHODS,1);           SetCheckBox(dptr,WATCH_DIALOG_MESSAGES,1);           SetCheckBox(dptr,WATCH_DIALOG_FOCUS,1);           count = NUMBER_OF_WATCH_ITEMS;           GetDItem(dptr,WATCH_DIALOG_NONE,&itemType,&itemHandle,&dispRect);           HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE);           GetDItem(dptr,WATCH_DIALOG_ALL,&itemType,&itemHandle,&dispRect);           HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE);           break;         case WATCH_DIALOG_NONE:           SetCheckBox(dptr,WATCH_DIALOG_COMPILATIONS,0);           SetCheckBox(dptr,WATCH_DIALOG_FACTS,0);           SetCheckBox(dptr,WATCH_DIALOG_INSTANCES,0);           SetCheckBox(dptr,WATCH_DIALOG_RULES,0);           SetCheckBox(dptr,WATCH_DIALOG_GENERIC_FUNCTIONS,0);           SetCheckBox(dptr,WATCH_DIALOG_MESSAGE_HANDLERS,0);           SetCheckBox(dptr,WATCH_DIALOG_DEFFUNCTIONS,0);           SetCheckBox(dptr,WATCH_DIALOG_STATISTICS,0);           SetCheckBox(dptr,WATCH_DIALOG_GLOBALS,0);           SetCheckBox(dptr,WATCH_DIALOG_SLOTS,0);           SetCheckBox(dptr,WATCH_DIALOG_ACTIVATIONS,0);           SetCheckBox(dptr,WATCH_DIALOG_METHODS,0);           SetCheckBox(dptr,WATCH_DIALOG_MESSAGES,0);           SetCheckBox(dptr,WATCH_DIALOG_FOCUS,0);           count = 0;           GetDItem(dptr,WATCH_DIALOG_NONE,&itemType,&itemHandle,&dispRect);           HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE);           GetDItem(dptr,WATCH_DIALOG_ALL,&itemType,&itemHandle,&dispRect);           HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE);           break;         case WATCH_DIALOG_OK:#if DEBUGGING_FUNCTIONS           SetWatchItem("compilations",GetCheckBox(dptr,WATCH_DIALOG_COMPILATIONS),NULL);           SetWatchItem("statistics",GetCheckBox(dptr,WATCH_DIALOG_STATISTICS),NULL);#if DEFTEMPLATE_CONSTRUCT           SetWatchItem("facts",GetCheckBox(dptr,WATCH_DIALOG_FACTS),NULL);#endif#if OBJECT_SYSTEM           SetWatchItem("instances",GetCheckBox(dptr,WATCH_DIALOG_INSTANCES),NULL);           SetWatchItem("message-handlers",GetCheckBox(dptr,WATCH_DIALOG_MESSAGE_HANDLERS),NULL);           SetWatchItem("slots",GetCheckBox(dptr,WATCH_DIALOG_SLOTS),NULL);           SetWatchItem("messages",GetCheckBox(dptr,WATCH_DIALOG_MESSAGES),NULL);#endif     #if DEFFUNCTION_CONSTRUCT                 SetWatchItem("deffunctions",GetCheckBox(dptr,WATCH_DIALOG_DEFFUNCTIONS),NULL);#endif#if DEFRULE_CONSTRUCT           SetWatchItem("rules",GetCheckBox(dptr,WATCH_DIALOG_RULES),NULL);           SetWatchItem("activations",GetCheckBox(dptr,WATCH_DIALOG_ACTIVATIONS),NULL);           SetWatchItem("focus",GetCheckBox(dptr,WATCH_DIALOG_FOCUS),NULL);#endif#if DEFGENERIC_CONSTRUCT           SetWatchItem("generic-functions",GetCheckBox(dptr,WATCH_DIALOG_GENERIC_FUNCTIONS),NULL);           SetWatchItem("methods",GetCheckBox(dptr,WATCH_DIALOG_METHODS),NULL);#endif#if DEFGLOBAL_CONSTRUCT           SetWatchItem("globals",GetCheckBox(dptr,WATCH_DIALOG_GLOBALS),NULL);#endif#endif           break;         case WATCH_DIALOG_CANCEL:           break;         case WATCH_DIALOG_USE_AS_DEFAULT:           theResource = CreateWatchResource(GetCheckBox(dptr,WATCH_DIALOG_COMPILATIONS),                                             GetCheckBox(dptr,WATCH_DIALOG_FACTS),                                             GetCheckBox(dptr,WATCH_DIALOG_RULES),                                             GetCheckBox(dptr,WATCH_DIALOG_STATISTICS),                                             GetCheckBox(dptr,WATCH_DIALOG_ACTIVATIONS),                                             GetCheckBox(dptr,WATCH_DIALOG_FOCUS),                                             GetCheckBox(dptr,WATCH_DIALOG_GLOBALS),                                             GetCheckBox(dptr,WATCH_DIALOG_DEFFUNCTIONS),                                             GetCheckBox(dptr,WATCH_DIALOG_GENERIC_FUNCTIONS),                                             GetCheckBox(dptr,WATCH_DIALOG_METHODS),                                             GetCheckBox(dptr,WATCH_DIALOG_INSTANCES),                                             GetCheckBox(dptr,WATCH_DIALOG_SLOTS),                                             GetCheckBox(dptr,WATCH_DIALOG_MESSAGE_HANDLERS),                                             GetCheckBox(dptr,WATCH_DIALOG_MESSAGES));           RememberPreferences(watchResType,watchResID,(Handle) theResource);           break;        }     }   /*=====================*/   /* Remove the dialog. */   /*=====================*/   DisposDialog(dptr);   /*============================*/   /* Restore the original port. */   /*============================*/   SetPort(savePort);  }/***********************************************//* DoOptionsDialog: Handle Options... command. *//***********************************************/void DoOptionsDialog()  {   DialogPtr dptr;   short int itemNumber = 0;   short int itemType;   Handle itemHandle;   Rect dispRect;   GrafPtr savePort;   ControlHandle ctrlHandle;   int currentStrategy, currentSalienceEval;   ExecutionRSRCHdl theResource;   extern BOOLEAN GetAutoFloatDividend(void);   extern BOOLEAN SetAutoFloatDividend(int);   /*=========================*/   /* Save the previous port. */   /*=========================*/   GetPort(&savePort);   /*==============================================*/   /* Get the dialog and make it the current port. */   /*==============================================*/   dptr = GetNewDialog(OPTIONS_DIALOG_RESOURCE_NUMBER,NULL,(WindowPtr) -1L);   InitCursor();   SetPort(dptr);   CenterWindow(dptr,0.5,0.33);   ShowWindow(dptr);   /*=====================================================================*/   /* Disable incremental reset check box if any rules are in the system. */   /*=====================================================================*/#if DEFRULE_CONSTRUCT   if (GetNextDefrule(NULL) != NULL)#endif     {      GetDItem(dptr,OPTIONS_DIALOG_INC_RESET,&itemType,&itemHandle,&dispRect);      ctrlHandle = (ControlHandle) itemHandle;      HiliteControl(ctrlHandle,INACTIVE_VALUE);     }   /*==================================================================*/   /* Outline the OK button to indicate that it is the default button. */   /*==================================================================*/   OutlineButton(dptr,OPTIONS_DIALOG_OK,TRUE);   /*=================================================================*/   /* Frame the two lines included in the dialog (for visual effect). */   /*=================================================================*/   PenPat(GRAY);   GetDItem(dptr,OPTIONS_DIALOG_TOP_LINE,&itemType,&itemHandle,&dispRect);   FrameRect(&dispRect);   GetDItem(dptr,OPTIONS_DIALOG_BOTTOM_LINE,&itemType,&itemHandle,&dispRect);   FrameRect(&dispRect);   PenPat(BLACK);   /*===============================================*/   /* The cursor for the dialog should be an arrow. */   /*===============================================*/   InitCursor();   /*===============================================*/   /* Set the dialog items to their current values. */   /*===============================================*/#if CONFLICT_RESOLUTION_STRATEGIES   currentStrategy = GetStrategy();#else   currentStrategy = DEPTH_STRATEGY;#endif   DrawPopupMenu(StrategyMenu,currentStrategy+1,dptr,OPTIONS_DIALOG_STRATEGY_USER_ITEM,TRUE);#if DYNAMIC_SALIENCE   currentSalienceEval = GetSalienceEvaluation();#else   currentSalienceEval = WHEN_DEFINED;#endif   DrawPopupMenu(SalienceMenu,currentSalienceEval+1,dptr,OPTIONS_DIALOG_DSALIENCE_USER_ITEM,TRUE);   SetCheckBox(dptr,OPTIONS_DIALOG_STATIC_CC_ITEM,GetStaticConstraintChecking());   SetCheckBox(dptr,OPTIONS_DIALOG_DYNAMIC_CC_ITEM,GetDynamicConstraintChecking());#if DEFGLOBAL_CONSTRUCT   SetCheckBox(dptr,OPTIONS_DIALOG_RESET_GLOBALS,GetResetGlobals());#endif#if DEFTEMPLATE_CONSTRUCT   SetCheckBox(dptr,OPTIONS_DIALOG_FACT_DUP,GetFactDuplication());#endif#if INCREMENTAL_RESET && (! RUN_TIME)   SetCheckBox(dptr,OPTIONS_DIALOG_INC_RESET,GetIncrementalReset());#endif   SetCheckBox(dptr,OPTIONS_DIALOG_AUTO_FLOAT,GetAutoFloatDividend());#if (! RUN_TIME)   SetCheckBox(dptr,OPTIONS_DIALOG_SEQ_OP,GetSequenceOperatorRecognition());#endif   /*=====================*/   /* Conduct the dialog. */   /*=====================*/   itemNumber = -1;   while ((itemNumber != WATCH_DIALOG_OK) && (itemNumber != WATCH_DIALOG_CANCEL))     {      ModalDialog((ModalPtr) DefaultDialogFilterRef,&itemNumber);      switch (itemNumber)        {         case OPTIONS_DIALOG_STRATEGY_USER_ITEM:           currentStrategy = DoPopupMenu(StrategyMenu,currentStrategy+1,dptr,                                         OPTIONS_DIALOG_STRATEGY_TEXT,                                         OPTIONS_DIALOG_STRATEGY_USER_ITEM) - 1;           DrawPopupMenu(StrategyMenu,currentStrategy+1,dptr,                         OPTIONS_DIALOG_STRATEGY_USER_ITEM,TRUE);           break;         case OPTIONS_DIALOG_DSALIENCE_USER_ITEM:           currentSalienceEval = DoPopupMenu(SalienceMenu,currentSalienceEval+1,dptr,                                             OPTIONS_DIALOG_DSALIENCE_TEXT,                                             OPTIONS_DIALOG_DSALIENCE_USER_ITEM) - 1;           DrawPopupMenu(SalienceMenu,currentSalienceEval+1,dptr,                         OPTIONS_DIALOG_DSALIENCE_USER_ITEM,TRUE);           break;                    case OPTIONS_DIALOG_STATIC_CC_ITEM:         case OPTIONS_DIALOG_DYNAMIC_CC_ITEM:         case OPTIONS_DIALOG_RESET_GLOBALS:         case OPTIONS_DIALOG_FACT_DUP:         case OPTIONS_DIALOG_INC_RESET:         case OPTIONS_DIALOG_AUTO_FLOAT:         case OPTIONS_DIALOG_SEQ_OP:           ToggleCheckBox(dptr,itemNumber);           break;         case OPTIONS_DIALOG_OK:#if CONFLICT_RESOLUTION_STRATEGIES           SetStrategy(currentStrategy);#endif#if DYNAMIC_SALIENCE           SetSalienceEvaluation(currentSalienceEval);#endif           SetStaticConstraintChecking(GetCheckBox(dptr,OPTIONS_DIALOG_STATIC_CC_ITEM));           SetDynamicConstraintChecking(GetCheckBox(dptr,OPTIONS_DIALOG_DYNAMIC_CC_ITEM));#if DEFGLOBAL_CONSTRUCT           SetResetGlobals(GetCheckBox(dptr,OPTIONS_DIALOG_RESET_GLOBALS));#endif#if DEFTEMPLATE_CONSTRUCT           SetFactDuplication(GetCheckBox(dptr,OPTIONS_DIALOG_FACT_DUP));#endif#if INCREMENTAL_RESET && (! RUN_TIME)           SetIncrementalReset(GetCheckBox(dptr,OPTIONS_DIALOG_INC_RESET));#endif           SetAutoFloatDividend(GetCheckBox(dptr,OPTIONS_DIALOG_AUTO_FLOAT));#if (! RUN_TIME)           SetSequenceOperatorRecognition(GetCheckBox(dptr,OPTIONS_DIALOG_SEQ_OP));#endif          break;         case OPTIONS_DIALOG_CANCEL:           break;                    case OPTIONS_DIALOG_USE_AS_DEFAULT:           theResource = CreateExecutionResource(currentSalienceEval,                                                 currentStrategy,                                                 GetCheckBox(dptr,OPTIONS_DIALOG_STATIC_CC_ITEM),                                                 GetCheckBox(dptr,OPTIONS_DIALOG_DYNAMIC_CC_ITEM),                                                 GetCheckBox(dptr,OPTIONS_DIALOG_RESET_GLOBALS),                                                 GetCheckBox(dptr,OPTIONS_DIALOG_SEQ_OP),                                                 GetCheckBox(dptr,OPTIONS_DIALOG_INC_RESET),                                                 GetCheckBox(dptr,OPTIONS_DIALOG_AUTO_FLOAT),                                                 GetCheckBox(dptr,OPTIONS_DIALOG_FACT_DUP));              RememberPreferences(executionResType,executionResID,(Handle) theResource);           break;        }     }   /*=====================*/   /* Remove the dialog. */   /*=====================*/   DisposDialog(dptr);   /*============================*/   /* Restore the original port. */   /*============================*/   SetPort(savePort);  }/********************************************************//* DoSetCommandsDialog: Handle Set Commands... command. *//********************************************************/void DoSetCommandsDialog()  {   DialogPtr dptr;   short int itemNumber = 0;   short int itemType;   Handle itemHandle;   Rect dispRect;   GrafPtr savePort;   Str255 itemString;   CommandsRSRCHdl theResource;   /*=========================*/   /* Save the previous port. */   /*=========================*/   GetPort(&savePort);   /*==============================================*/   /* Get the dialog and make it the current port. */   /*==============================================*/   InitCursor();   dptr = GetNewDialog(SET_COMMANDS_DIALOG_RESOURCE_NUMBER,NULL,(WindowPtr) -1L);   SetPort(dptr);   CenterWindow(dptr,0.5,0.33);   ShowWindow(dptr);   /*==================================================================*/   /* Outline the OK button to indicate that it is the default button. */   /*==================================================================*/   OutlineButton(dptr,WATCH_DIALOG_OK,TRUE);   /*=================================================================*/   /* Frame the two lines included in the dialog (for visual effect). */   /*=================================================================*/   PenPat(GRAY);   GetDItem(dptr,SET_COMMANDS_DIALOG_TOP_LINE,&itemType,&itemHandle,&dispRect);   FrameRect(&dispRect);   GetDItem(dptr,SET_COMMANDS_DIALOG_BOTTOM_LINE,&itemType,&itemHandle,&dispRect);   FrameRect(&dispRect);   PenPat(BLACK);   /*===============================================*/   /* The cursor for the dialog should be an arrow. */   /*===============================================*/   InitCursor();   /*=======================================================*/   /* Set the commands check boxes to their current values. */   /*=======================================================*/#if DEBUGGING_FUNCTIONS      GetItem(CommandsMenu,Command1Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND1,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);   GetItem(CommandsMenu,Command2Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND2,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);   GetItem(CommandsMenu,Command3Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND3,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);   GetItem(CommandsMenu,Command4Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND4,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);   GetItem(CommandsMenu,Command5Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND5,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);   GetItem(CommandsMenu,Command6Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND6,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);   GetItem(CommandsMenu,Command7Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND7,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);   GetItem(CommandsMenu,Command8Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND8,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);   GetItem(CommandsMenu,Command9Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND9,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);   GetItem(CommandsMenu,Command0Item,itemString);      GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND0,&itemType,&itemHandle,&dispRect);   SetIText(itemHandle,itemString);#endif   /*=====================*/   /* Conduct the dialog. */   /*=====================*/   itemNumber = -1;   while ((itemNumber != SET_COMMANDS_DIALOG_OK) && (itemNumber != SET_COMMANDS_DIALOG_CANCEL))     {      ModalDialog((ModalPtr) DefaultDialogFilterRef,&itemNumber);      switch (itemNumber)        {         case SET_COMMANDS_DIALOG_OK:           GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND1,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command1Item,itemString);              GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND2,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command2Item,itemString);               GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND3,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command3Item,itemString);               GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND4,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command4Item,itemString);               GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND5,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command5Item,itemString);               GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND6,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command6Item,itemString);               GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND7,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command7Item,itemString);               GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND8,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command8Item,itemString);               GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND9,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command9Item,itemString);               GetDItem(dptr,SET_COMMANDS_DIALOG_COMMAND0,&itemType,&itemHandle,&dispRect);           GetIText(itemHandle,itemString);           SetItem(CommandsMenu,Command0Item,itemString);                         break;         case SET_COMMANDS_DIALOG_CANCEL:           break;         case SET_COMMANDS_DIALOG_USE_AS_DEFAULT:           theResource = CreateCommandsResource(dptr);           RememberPreferences(commandsResType,commandsResID,(Handle) theResource);           break;        }     }   /*=====================*/   /* Remove the dialog. */   /*=====================*/   DisposDialog(dptr);   /*============================*/   /* Restore the original port. */   /*============================*/   SetPort(savePort);  } 