   /*******************************************************/   /*      "C" Language Integrated Production System      */   /*                                                     */   /*             Macintosh Version 3.3  04/02/96         */   /*                                                     */   /*   DEFFACTS AND DEFTEMPLATE DIALOG MANAGER MODULE    */   /*******************************************************//*************************************************************//* Purpose:                                                  *//*                                                           *//* Principal Programmer(s):                                  *//*      Gary D. Riley                                        *//*                                                           *//* Contributing Programmer(s):                               *//*                                                           *//* Revision History:                                         *//*                                                           *//*************************************************************/#define _FACTDLOG_SOURCE_#include "setup.h"#include <Dialogs.h>#if MAC_SC7 || MAC_MCW || MAC_SC8#define ClickPtr ListClickLoopUPP#else#define ClickPtr ProcPtr#endif#if MAC_MCW || MAC_SC8#define ModalPtr ModalFilterUPP#else#define ModalPtr ModalFilterProcPtr#endif#include "router.h"#include "commline.h"#include "dffctdef.h"#include "dffctbsc.h"#include "tmpltdef.h"#include "tmpltbsc.h"#include "dlogmngr.h"#include "window.h"#include "stnrdmac.h"#include "factdlog.h"/***************************************//* LOCAL INTERNAL FUNCTION DEFINITIONS *//***************************************/   static void                   UpdateDeffactsButtons(DialogPtr,int);   static void                   UpdateDeftemplateButtons(DialogPtr,int);#if DEFFACTS_CONSTRUCT/**********************************************************//* DoDeffactsManager: Handle Deffacts Manager... command. *//**********************************************************/void DoDeffactsManager()  {   short int itemNumber = 0;   int selection;   int numberOfDeffacts;   CreateDialogManager(DEFFACTS_DIALOG_RESOURCE_NUMBER,TRUE);   numberOfDeffacts = PrepManager(DEFFACTS_DIALOG_SELECT,                                  GetNextDeffacts,                                  (char *(*)(VOID *)) GetConstructNameString,                                  TRUE,false,(StringPtr) "\p");   /*===============================================================*/   /* Define a ClikLoop function to be called repeatedly as long as */   /* the mouse button is held down inside the list of items. This  */   /* loop will update buttons applicable to the currently selected */   /* item.                                                         */   /*===============================================================*/   UpdateConstructManagerButtonsFunction = UpdateDeffactsButtons;   (*Choices)->lClickLoop = (ClickPtr) DefaultConstructManagerClikloopRef;   /*===========================================================*/   /* Set a global variable indicating which item in the dialog */   /* box is the list. This global value will be used by the    */   /* filter function for the dialog box.                       */   /*===========================================================*/   SelectItem = DEFFACTS_DIALOG_SELECT;   /*====================================================*/   /* Initialize the last dialog item selected variable. */   /*====================================================*/   itemNumber = DEFFACTS_DIALOG_SELECT;   selection = PutSelectionNameInBuffer();   /*====================================================================*/   /* Outline the Done button to indicate that it is the default button. */   /*====================================================================*/   OutlineButton(ManagerDialog,DEFFACTS_DIALOG_DONE,TRUE);   /*===============================================*/   /* Update the buttons for the current selection. */   /*===============================================*/   UpdateDeffactsButtons(ManagerDialog,selection);   /*==================================================================*/   /* Remain in this loop until the user has selected the done button. */   /* The function SingleSelectFilter that is passed as an argument to */   /* ModalDialog is used to handle mouse-clicks in the list.          */   /*==================================================================*/   while (itemNumber != DEFFACTS_DIALOG_DONE)     {      ModalDialog((ModalPtr) SingleSelectFilterRef,&itemNumber);      switch(itemNumber)        {         case DEFFACTS_DIALOG_SELECT:           selection = PutSelectionNameInBuffer();           break;         case DEFFACTS_DIALOG_PRINT:           GenericPrintButton(FindDeffacts,(char *(*)(VOID *)) GetConstructPPForm,"(ppdeffacts ",NULL);           break;         case DEFFACTS_DIALOG_REMOVE:           GenericDeleteButton1(FindDeffacts,Undeffacts,&selection,&numberOfDeffacts,(StringPtr) "\p");           break;         default:           break;        }      UpdateDeffactsButtons(ManagerDialog,selection);     }   CleanUpAfterManagerDialog(TRUE);  }/**********************************************//* UpdateDeffactsButtons: Updates the buttons *//* in the Deffacts Manager dialog box.        *//**********************************************/static void UpdateDeffactsButtons(dptr,selection)  DialogPtr dptr;  int selection;  {#if MAC_MPW || MAC_MCW#pragma unused(selection)#endif   Handle itemHandle;   Rect dispRect;   short int itemType;   void *theDeffacts;   PutSelectionNameInBuffer();   theDeffacts = FindDeffacts(DialogBuffer);   /*=========================================================*/   /* Get information about the remove... button dialog item. */   /*=========================================================*/   GetDItem(dptr,DEFFACTS_DIALOG_REMOVE,&itemType,&itemHandle,&dispRect);   if ((theDeffacts == NULL) ? false : IsDeffactsDeletable(theDeffacts))     { HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE); }   else     { HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE); }   /*=========================================================*/   /* Get information about the print... button dialog item. */   /*=========================================================*/   GetDItem(dptr,DEFFACTS_DIALOG_PRINT,&itemType,&itemHandle,&dispRect);   if ((theDeffacts == NULL) ? false : (GetDeffactsPPForm(theDeffacts) != NULL))     { HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE); }   else     { HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE); }  }#endif#if DEFTEMPLATE_CONSTRUCT/****************************************************************//* DoDeftemplateManager: Handle Deftemplate Manager... command. *//****************************************************************/void DoDeftemplateManager()  {   short int itemNumber = 0;   int selection;   int numberOfDeftemplates;   VOID *theTemplate;      CreateDialogManager(DEFTEMPLATE_DIALOG_RESOURCE_NUMBER,TRUE);   numberOfDeftemplates = PrepManager(DEFTEMPLATE_DIALOG_SELECT,                                  GetNextDeftemplate,                                  (char *(*)(VOID *)) GetConstructNameString,TRUE,false,(StringPtr) "\p");   /*===============================================================*/   /* Define a ClikLoop function to be called repeatedly as long as */   /* the mouse button is held down inside the list of items. This  */   /* loop will update buttons applicable to the currently selected */   /* item.                                                         */   /*===============================================================*/   UpdateConstructManagerButtonsFunction = UpdateDeftemplateButtons;   (*Choices)->lClickLoop = (ClickPtr) DefaultConstructManagerClikloopRef;   /*===========================================================*/   /* Set a global variable indicating which item in the dialog */   /* box is the list. This global value will be used by the    */   /* filter function for the dialog box.                       */   /*===========================================================*/   SelectItem = DEFTEMPLATE_DIALOG_SELECT;   /*====================================================*/   /* Initialize the last dialog item selected variable. */   /*====================================================*/   itemNumber = DEFTEMPLATE_DIALOG_SELECT;   selection = PutSelectionNameInBuffer();   /*====================================================================*/   /* Outline the Done button to indicate that it is the default button. */   /*====================================================================*/   OutlineButton(ManagerDialog,DEFTEMPLATE_DIALOG_DONE,TRUE);   /*===============================================*/   /* Update the buttons for the current selection. */   /*===============================================*/   UpdateDeftemplateButtons(ManagerDialog,selection);   /*==================================================================*/   /* Remain in this loop until the user has selected the done button. */   /* The function SingleSelectFilter that is passed as an argument to */   /* ModalDialog is used to handle mouse-clicks in the list.          */   /*==================================================================*/   while (itemNumber != DEFTEMPLATE_DIALOG_DONE)     {      ModalDialog((ModalPtr) SingleSelectFilterRef,&itemNumber);      switch(itemNumber)        {         case DEFTEMPLATE_DIALOG_SELECT:           selection = PutSelectionNameInBuffer();           break;         case DEFTEMPLATE_DIALOG_PRINT:           GenericPrintButton(FindDeftemplate,(char *(*)(VOID *)) GetConstructPPForm,"(ppdeftemplate ",NULL);           break;         case DEFTEMPLATE_DIALOG_REMOVE:           GenericDeleteButton1(FindDeftemplate,Undeftemplate,&selection,                                &numberOfDeftemplates,(StringPtr) "\p");           break;                    case DEFTEMPLATE_DIALOG_WATCH:#if DEBUGGING_FUNCTIONS           theTemplate = FindDeftemplate(DialogBuffer);           if (theTemplate != NULL)             SetDeftemplateWatch(GetDeftemplateWatch(theTemplate) ? OFF : ON,theTemplate);#endif           break;                   }      UpdateDeftemplateButtons(ManagerDialog,selection);     }   CleanUpAfterManagerDialog(TRUE);  }/*************************************************//* UpdateDeftemplateButtons: Updates the buttons *//* in the Deftemplate Manager dialog box.        *//*************************************************/static void UpdateDeftemplateButtons(dptr,selection)  DialogPtr dptr;  int selection;  {#if MAC_MPW || MAC_MCW#pragma unused(selection)#endif   Handle itemHandle;   Rect dispRect;   short int itemType;   void *theDeftemplate;   PutSelectionNameInBuffer();   theDeftemplate = FindDeftemplate(DialogBuffer);   /*=========================================================*/   /* Get information about the remove... button dialog item. */   /*=========================================================*/   GetDItem(dptr,DEFTEMPLATE_DIALOG_REMOVE,&itemType,&itemHandle,&dispRect);   if ((theDeftemplate == NULL) ? false : IsDeftemplateDeletable(theDeftemplate))     { HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE); }   else     { HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE); }   /*=========================================================*/   /* Get information about the print... button dialog item. */   /*=========================================================*/   GetDItem(dptr,DEFTEMPLATE_DIALOG_PRINT,&itemType,&itemHandle,&dispRect);   if ((theDeftemplate == NULL) ? false : (GetDeftemplatePPForm(theDeftemplate) != NULL))     { HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE); }   else     { HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE); }        /*=========================================================*/   /* Get information about the trace... button dialog item. */   /*=========================================================*/   GetDItem(dptr,DEFTEMPLATE_DIALOG_WATCH,&itemType,&itemHandle,&dispRect);#if DEBUGGING_FUNCTIONS   if (theDeftemplate != NULL)     {      SetCheckBox(dptr,DEFTEMPLATE_DIALOG_WATCH,GetDeftemplateWatch(theDeftemplate));      HiliteControl((ControlHandle) itemHandle,ACTIVE_VALUE);     }   else#endif     {      SetCheckBox(dptr,DEFTEMPLATE_DIALOG_WATCH,OFF);      HiliteControl((ControlHandle) itemHandle,INACTIVE_VALUE);     }  }#endif